# 轻量级工作台 - 高层设计（v0）

> 本稿仅覆盖“方向级/架构级”方案，用于对齐思路；细节与接口在确认后逐步补充。

## 0. 分层约定（仅保留方向层内容）
- 方向层（稳定，写在本文件）：愿景、非目标、领域边界、统一抽象与接口契约、UI 信息架构原则。
- 方案层（可变，独立 RFC）：具体方案与权衡、数据流、错误与降级、性能预算，每个主题一份 RFC。
- 实现层（易变，贴近代码）：模块拆分、依赖、配置、代码结构，写在代码内 README/注释/开发文档。

说明：design.md 永远只放方向层“稳定结论与承诺”，方案层与实现层的细节以链接形式引用，不在此展开。

## 1. 目标与范围
- 统一精简模型：所有工作事项遵循一套 `WorkItem` 抽象，按类别扩展属性。
- 首期集成域：Git 仓库相关子系统集合（代码托管与代码活动摘要）。
- 只做摘要与跳转：不承载增删改查与复杂操作。

## 2. 统一精简模型（方向）
- 单一抽象：`WorkItem`（最小必需字段 + 可选属性映射）。
- 最小字段：`id`, `title`, `description`, `url`。
- 分类扩展（不破坏统一抽象）：通过 `kind` 与 `attributes`（键值对）承载差异。
  - 示例 `kind`：`code`（首期） | `task` | `environment` | `notice` ...；最终支持“自定义 kind”。
- 数据文件：`data/workitems.json`（单一事实源；只读给前端）。
- 统一 Schema：见 `docs/schemas/workitem.schema.json`（方向层仅给出最小字段与原则）。

## 3. 技术选项（高层）
- 前端：Vue + Tailwind CSS + shadcn-vue 组件集；图标采用 Uno Icons（lucide 图标源，按需引入 SVG）。
- 数据来源：本地 JSON 文件（单一事实源），由钩子脚本定期/手动更新。
- 更新机制：各平台独立“更新钩子”脚本（可并行执行），将数据写入统一 JSON 文件。
- 部署：静态站点（前端 + 本地 JSON）；更新钩子可由定时任务/CI 触发执行。

## 4. 整体框架（概览）
- 数据层：统一 JSON 数据文件（只读给前端），结构遵循 `WorkItem` 抽象与分类扩展。
- 更新层：平台钩子脚本（如 GitHub 钩子）拉取外部数据，写入 JSON；失败不影响前端读取旧数据。
- 展示层：Dashboard + 列表视图；全部条目均含“直达”链接。
- 配置层：以 JSON/YAML 管理钩子与数据位置，新增来源无需改动前端核心。

```
[Hooks (GitHub/GitLab/...)]  -->  [data/workitems.json]  -->  [Front-end (Vue)]
         (按计划/手动)                 (统一结构)                (只读展示)
```

## 5. 首期：Git 子系统集合（范围）
- 目标：在一个页面集中展示“仓库入口列表”，一键跳转到对应平台。
- 覆盖平台（首期）：GitHub（优先）；后续扩展 GitLab / Gitea（按配置启用）。
- 内容摘要（方向）：
  - 仓库快捷入口卡片：仓库名称、简述、链接。
- 能力边界：
  - 不展示 PR/MR、提交、活动等动态信息。
  - 仅提供仓库级跳转入口与最小描述。

### 5.1 kind 启动范围
- v0：仅支持 `kind=code`（仓库入口）。
- v1：支持多 kind（如 `task`、`environment`），前端以筛选切换。
- v2：支持“自定义 kind”（通过注册机制接入，前端无需改核心）。

## 6. UI 高层框架（草图）

- 总体布局（按草图）：左右双栏
  - 左侧：功能区（窄栏，固定）
  - 右侧：资源列表视图（宽区，唯一主视图）

- 左侧功能区（固定项）
  - 全局功能：
    - 功能 1
  - kind 子项通用功能：
    - 功能 1
  - kind 子项独有的功能：
    - 功能 1
    - 功能 2

- 右侧资源列表视图（仅保留此视图；移除“Resource Templates / 详情面板”等）
  - 顶部筛选条（“筛选”）
    - 关键字搜索（本地模糊匹配 title/description）
    - Provider/分组选择（可选）
    - 不提供“刷新”按钮；属性改变即刻生效（本地过滤/排序）
  - 子项列表（“子项列表”）
    - 列表项含最小字段：title、description、url
    - 整行点击跳转新标签页
    - 右侧次要操作：复制链接、收藏（可选）
  - 空态：显示“暂无资源，等待钩子更新”

- 极简草图（为避免中英文宽度差导致错位，以下图内仅用 ASCII 英文，中文说明在图外）
```
+---------------- L: Sidebar -------------------+----------------- R: Resource List View ------------------+
| Global                                         |  Top: kind2 | kind3 | kind4                             |
| - Action 1                                     |  +----------------- Top Filters -------------------+    |
| Common(kind)                                   |  | Search    Provider(optional)   (instant update) |    |
| - Action 1                                     |  +-------------------------------------------------+    |
| Specific(kind)                                 |  +-------------------- Items ----------------------+    |
| - Action 1                                     |  | [icon] title                         Open  ★Fav |    |
| - Action 2                                     |  | [icon] title                         Open  ★Fav |    |
+------------------------------------------------+---------------------------------------------------------+
```

- 行为说明
  - 仅加载与展示本地 `data/workitems.json`；无模板面板、无详情面板
  - 所有筛选与排序在前端本地完成；属性变更触发即时过滤与渲染，无需点击刷新

## 7. 里程碑（建议）
- M1：跑通一个 Git Provider（如 GitHub），完成统一模型与页面骨架。
- M2：扩展第二个 Provider（如 GitLab），验证“统一抽象 + 适配器”机制。
- M3：补充缓存/降级策略与基础筛选；灰度试用与优化。

## 8. 数据策略（方向解释）
- 单一事实源：前端仅读取本地 `data/workitems.json`，无跨域/鉴权问题，离线可用。
- 钩子更新：按计划任务（如 cron/CI）或手动执行平台钩子，拉取增量并写入 JSON；失败时保留旧数据。
- 可扩展性：新增平台=新增钩子脚本与数据映射，不改前端与现有数据结构。
 - 数据路径与部署：前端从相对路径 `/data/workitems.json` 读取；允许通过环境前缀（如 `PUBLIC_BASE_PATH`）调整部署子路径。
 - 错误与降级：文件缺失/解析失败时显示空态并提示“数据文件不可用”。
 - 写入策略（默认）：多钩子并发写入采用“最后写入者覆盖”；是否引入单聚合钩子在 RFC-002 再议。
 - 安全约束：JSON 仅包含对外可见信息，不写入访问令牌、内网地址等敏感数据。

### 8.1 kind 注册机制（方向）
- 统一 `WorkItem` 四个最小字段保持不变：`id/title/description/url`。
- 以 `kind` + `attributes` 承载差异：
  - 每个 `kind` 定义自己的属性键约定（RFC 描述），写入 `attributes`。
  - 前端以“kind→渲染器”的映射渲染卡片。未识别的 kind 走默认渲染（仅最小字段）。
- 自定义 kind：
  - 新增一个 `kind` 名称 + 简短说明 + 示例 JSON，即可被前端默认渲染；
  - 若需要专属样式/图标，可通过“渲染器注册表”配置：`kindName -> renderer`（配置文件，不改代码）。
